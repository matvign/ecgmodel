# PyQt vs tkinter
PyQt looks nice and has a more comfortable set of widgets to program in.
It also has excellent documentation (albeit written in C++).


# Building ECG
An ECG is generated by using the equations as described in this 
[paper](http://web.mit.edu/~gari/www/papers/ieeetbe50p289.pdf).

The current implementation does not incorporate noise.


# ECG Extended Kalman Filter
A Kalman Filter consists of a predict and update step. The predict and update 
step keeps track of a state and covariance matrix.

Kalman Filters only work with linear equations. The ECG model proposed by 
McSharry et. al is non-linear. For this reason, an Extended Kalman Filter (EKF) must be used.

## Predict Step
The predict step of the EKF uses the original linear system of equations represented
by function `f` to predict where the next state and covariance matrix might be.

What are we predicting?
* If we are predicting the next state then we have to use an ODE solver, get the result and then update it.  
To achieve this we might need to subclass ODESolver or use a different ODE solver function.

* If we're only predicting the next gradient then all we need to do is pass it through an ODE solver.

The matrix `A_k` is the partial derivative of `f` wrt state variables `xyz`.
```
dF/dx   dF/dy   dF/dz
dG/dx   dG/dy   dG/dz
dH/dx   dH/dy   dH/dy
```
The matrix `F_k` is the partial derivative of `f` wrt noise variable `w`.
```
dF/dw       0
dG/dw   =   0
dH/dw       0
```

## Update Step
The update step takes our predicted state and updates it with an observation `y_k`. In our case `y_k` is the amplitude of our ECG sample.

The update is performed with a function `g`.
```
s_k = [0 0 1]X^T + v_k 
    = [0 0 1]*[x y z]^T + v_k
    = [z + v_k]
```
The matrix `C_k` is the partial derivative of `g` wrt state variables xyz.
```
dG/dx   dG/dy   dG/dz   =   [0 0 1]
```
The matrix `G_k` is the partial derivative of `g` wrt noise. This is assuming that `v_k` is a constant and not some sort of matrix.
```
dG/dv   =   [1]
```

## Measurement and Process Noise
The process noise is effectively 0 since the derivative of `F` wrt noise is `[0 0 0]^T`.

The measurement noise `R_k` can be set to `1` or `10^6`, which is the value used in [2].

What is still uncertain is the value of `v_k`. 
* Is this value a matrix? If so then `v_k * v_k^t = R_k`
* Is this value a constant? If so then `v_k = R_k`


## Initial State and Covariant Matrix
The initial state is given in matrix form 
```
[
    [x]
    [y]
    [z]
]
```

The initial covariant matrix is ...?


# Resources
Useful resources:
1. [A Dynamical Model for Generating Synthetic Electrocardiogram Signals](http://web.mit.edu/~gari/www/papers/ieeetbe50p289.pdf)
2. [Filtering Electrocardiogram Signals Using The Extended Kalman Filter](https://hal.archives-ouvertes.fr/hal-00174347/document)
3. [How a Kalman Filter Works](https://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/)
4. [Kalman and Bayesian Filters in Python](https://nbviewer.jupyter.org/github/rlabbe/Kalman-and-Bayesian-Filters-in-Python/blob/master/table_of_contents.ipynb
)
5. [Extended Kalman Filter Explained with Python Code](http://ros-developer.com/2019/04/11/extended-kalman-filter-explained-with-python-code/)
